(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{341:function(e,t,n){"use strict";var r=n(1),o=n(86).findIndex,c=n(160),d="findIndex",l=!0;d in[]&&Array(1)[d]((function(){l=!1})),r({target:"Array",proto:!0,forced:l},{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),c(d)},367:function(e,t,n){"use strict";var r=n(1),o=n(86).find,c=n(160),d="find",l=!0;d in[]&&Array(1)[d]((function(){l=!1})),r({target:"Array",proto:!0,forced:l},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),c(d)},368:function(e,t,n){"use strict";var r=n(28),o=n(102),c=n(3),d=(n(40),n(39),n(82),n(42),n(341),n(162),n(80),n(81),n(41),n(18),n(43),n(29));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a={props:{tableName:{type:String},headers:{type:Array,required:!0},items:{type:Array,required:!0},filters:{type:Array,default:function(){return[]}},hasPagination:{type:Boolean,default:!1},currentPage:{type:Number,default:1},totalPages:{type:Number,default:1},backFunction:{type:Function},model:{type:String},parentItem:{type:Object}},data:function(){return{dropdownOpenItemId:null,currentItem:null,editableItem:null,focusedItem:{},prevFocusedItem:null,localItems:[],newItemFormOpen:!1,originalById:{},dirtyById:{}}},created:function(){this.localItems=JSON.parse(JSON.stringify(this.visibleItems))},computed:{visibleItems:function(){return this.currentItem?[this.currentItem]:this.items}},watch:{focusedItem:{handler:function(e,t){t&&Object.keys(t).length>0&&(this.prevFocusedItem=JSON.parse(JSON.stringify(t))),console.log("focusedItem has changed. Old value stored in prevFocusedItem:",this.prevFocusedItem)},deep:!0},visibleItems:function(e){this.newItemFormOpen=!1,this.localItems=JSON.parse(JSON.stringify(e))},newItemFormOpen:function(e){e?(this.initializeItems(this.localItems),this.focusedItem=this.localItems[0]):this.localItems=JSON.parse(JSON.stringify(this.visibleItems))}},methods:{getAuthHeaders:function(){var e=localStorage.getItem("admin_token");return{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}},setCurrent:function(filter){this.currentfilter=filter},seteditableItem:function(e){this.editableItem=e,console.log(this.editableItem)},toggleDropdown:function(e){this.dropdownOpenItemId===e._id?this.dropdownOpenItemId=null:this.dropdownOpenItemId=e._id},closeDropdown:function(e){this.dropdownOpenItemId=null},setFocused:function(e){var t=e.item,n=e.inputId;this.focusedItem=t,this.dropdownOpenItemId=null,this.$nextTick((function(){var e=document.getElementById(n);e&&e.focus()})),this.ensureOriginalSnapshot(t),"0"!==this.focusedItem._id&&this.closeNewItemForm()},openNewItemForm:function(){this.newItemFormOpen=!0},closeNewItemForm:function(){this.newItemFormOpen=!1},closeItem:function(){this.currentItem=null,this.currentVariants=[],this.seteditableItem(null),this.focusedItem={},this.closeNewItemForm()},handleImageUpload:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var r,c,l,f,h,data,I,y,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.target.files[0]){n.next=3;break}return n.abrupt("return");case 3:return(c=new FormData).append("image",r),t.imageUploading=!0,l=e.target.id,f=l.split("-").pop(),n.prev=8,n.next=11,fetch("".concat(d.c,"/admin/upload-image?itemId=").concat(f,"&model=").concat(t.model),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("admin_token"))},body:c});case 11:return h=n.sent,n.next=14,Object(d.b)(h);case 14:return n.next=16,h.json();case 16:(data=n.sent).url?-1!==(I=t.localItems.findIndex((function(e){return e._id===f})))&&(y=Object(o.a)(t.localItems),v=m(m({},y[I]),{},{image:data.url}),y[I]=v,t.localItems=y):Object(d.d)("Failed to upload image"),n.next=24;break;case 20:n.prev=20,n.t0=n.catch(8),console.error("Image upload error:",n.t0),Object(d.d)(n.t0.message||"Image upload failed");case 24:return n.prev=24,t.imageUploading=!1,n.finish(24);case 27:case"end":return n.stop()}}),n,null,[[8,20,24,27]])})))()},cloneDeep:function(e){return JSON.parse(JSON.stringify(e))},ensureOriginalSnapshot:function(e){var t=e._id;this.originalById[t]||(this.originalById[t]=this.cloneDeep(e),this.$set(this.dirtyById,t,{}))},isKeyDirty:function(e,t){var map=this.dirtyById[e];return!(!map||!map[t])},isRowDirty:function(e){var map=this.dirtyById[e];return!!map&&Object.keys(map).length>0},onFieldInput:function(e,t){var n,r=this.localItems.findIndex((function(i){return i._id===e}));if(-1!==r){var o=null===(n=this.originalById[e])||void 0===n?void 0:n[t],c=this.localItems[r][t];this.dirtyById[e]||this.$set(this.dirtyById,e,{}),JSON.stringify(o)===JSON.stringify(c)?this.dirtyById[e][t]&&this.$delete(this.dirtyById[e],t):this.$set(this.dirtyById[e],t,!0)}},finalizeSaveSnapshot:function(e){var t=e._id;this.originalById[t]=this.cloneDeep(e),this.$set(this.dirtyById,t,{})}}}},421:function(e,t,n){"use strict";n.r(t);n(82),n(50),n(44);var r=n(3),o=n(102),c=(n(40),n(42),n(367),n(341),n(41),n(18),n(220),n(35),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(36),n(368)),d=n(29),l={mixins:[c.a],methods:{initializeItems:function(e){var t=this,n=Object(o.a)(JSON.parse(JSON.stringify(e)));if(n.length>0&&!this.currentItem){var r=n[0],c=Object.keys(r).reduce((function(e,n){return"_id"===n?e[n]="0":"image"===n?e[n]=null:"price"===n?e[n]=0:"availability"===n?e[n]="YES":"productId"===n?(e[n]=t.parentItem._id,console.log("fond the prif",t.parentItem)):["createdAt","updatedAt"].includes(n)?e[n]=(new Date).toISOString():e[n]="variants"===n?[]:"",e}),{});n.unshift(c)}var d=new Set,l=n.filter((function(e){var t=d.has(e._id);return d.add(e._id),!t}));this.localItems=l},deleteItem:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(confirm("Are you sure you want to delete this variant?")){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,fetch("".concat(d.c,"/admin/delete-variant/").concat(e),{method:"DELETE",headers:t.getAuthHeaders()});case 5:return r=n.sent,n.next=8,Object(d.b)(r);case 8:r.ok?(t.localItems=t.localItems.filter((function(t){return t._id!==e})),t.focusedItem&&t.focusedItem._id===e&&(t.focusedItem={}),t.originalById&&t.originalById[e]&&delete t.originalById[e],t.dirtyById&&t.dirtyById[e]&&(t.$delete?t.$delete(t.dirtyById,e):delete t.dirtyById[e])):Object(d.d)("Failed to delete variant. Please try again."),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(2),console.error("Delete variant error:",n.t0),Object(d.d)(n.t0.message||"Failed to delete variant");case 15:case"end":return n.stop()}}),n,null,[[2,11]])})))()},saveItem:function(e){var t=this.localItems.find((function(t){return t._id===e._id}));console.log(t),this.saveItemToDB(t)},saveItemToDB:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(d.c,"/admin/update-variant/").concat(e._id),{method:"PUT",headers:t.getAuthHeaders(),body:JSON.stringify(e)});case 3:return r=n.sent,n.next=6,Object(d.b)(r);case 6:t.focusedItem={},n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),console.error("Update error:",n.t0);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})))()},saveNewItemToDB:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,c,l,m,f,h,I;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.localItems.find((function(i){return"0"===i._id}))||e.localItems[0]||{},r=e.productId||n.productId||e.editableItem&&e.editableItem._id,console.log(r,"productId"),r){t.next=6;break}throw new Error("Missing productId for add-variant request");case 6:if((c={unit:n.unit,price:n.price,availability:n.availability,image:n.image}).unit&&c.price&&c.availability&&c.image){t.next=9;break}throw new Error("All fields are required: unit, price, availability, image");case 9:return t.next=11,fetch("".concat(d.c,"/admin/add-variant/").concat(r),{method:"POST",headers:e.getAuthHeaders(),body:JSON.stringify(c)});case 11:return l=t.sent,t.next=14,Object(d.b)(l);case 14:return t.next=16,l.json();case 16:m=t.sent,f=m.variant,h=Object(o.a)(e.localItems),-1!==(I=h.findIndex((function(i){return"0"===i._id})))?h[I]=f:h.unshift(f),e.localItems=h,e.finalizeSaveSnapshot(f),e.focusedItem={},e.newItemFormOpen=!1,t.next=31;break;case 27:t.prev=27,t.t0=t.catch(0),console.error("Add product error:",t.t0),Object(d.d)(t.t0.message||"Failed to add variant");case 31:case"end":return t.stop()}}),t,null,[[0,27]])})))()}}},m=n(62),component=Object(m.a)(l,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"admintable__content"},[t("div",{staticClass:"admintable__headerarea"},[t("div",{staticClass:"admintable__headerarea--section"},[e.backFunction?t("span",{staticClass:"admintable__headerarea--backbutton"},[t("svg",{attrs:{"data-v-7f082eaa":""}},[t("use",{attrs:{"data-v-7f082eaa":"","xlink:href":"/svg/symbol-defs.svg#icon-arrow_back"}})])]):e._e(),e._v(" "),t("h1",{staticClass:"admintable__h1"},[e._v(e._s(e.tableName))])]),e._v(" "),e.currentItem?e._e():t("div",{staticClass:"admintable__headerarea--section"},[t("button",{staticClass:"newitem",on:{click:e.openNewItemForm}},[e._v("New Item")])])]),e._v(" "),t("div",{staticClass:"admintable__table-wrapper"},[t("table",{staticClass:"admintable__table"},[t("thead",{staticClass:"admintable__tableh"},[t("tr",e._l(e.headers,(function(header,n){return t("th",{key:n,class:header.class},[t("span",[t("span",[e._v(e._s(header.text))])])])})),0)]),e._v(" "),t("tbody",{staticClass:"admintable__tableb"},[e._l(e.localItems,(function(n,r){return[t("tr",e._l(e.headers,(function(header,r){return t("td",{key:r,class:header.class},[t("div",["actions"===header.key?[t("div",{staticClass:"admintable__actions"},[e.focusedItem._id===n._id?t("button",{staticClass:"admintable__actions--savebtn cancel",on:{click:e.closeItem}},[e._v("\n                                                Cancel\n                                            ")]):e._e(),e._v(" "),e.focusedItem._id===n._id&&"0"!==n._id&&e.isRowDirty(n._id)||e.currentItem?t("button",{staticClass:"admintable__actions--savebtn save",on:{click:function(t){return e.saveItem(n)}}},[e._v("\n                                                Save\n                                            ")]):e._e(),e._v(" "),e.focusedItem._id===n._id&&"0"===n._id&&n.image&&n.unit&&n.price&&n.availability?t("button",{staticClass:"admintable__actions--savebtn save",on:{click:function(t){return e.saveNewItemToDB(n)}}},[e._v("Save")]):e._e(),e._v(" "),e.focusedItem._id!==n._id?t("button",{staticClass:"admintable__actions--savebtn delete",on:{click:function(t){return t.stopPropagation(),e.deleteItem(n._id)}}},[e._v("\n                                                Delete\n                                            ")]):e._e()])]:"image"===header.key?[t("figure",{staticClass:"admintable__content--img"},[t("label",{attrs:{for:"image-upload-"+n._id}},[t("img",{attrs:{width:"30",height:"30",src:n.image?n.image:"/imgs/cartlogo.png",alt:n.name}})]),e._v(" "),t("input",{staticStyle:{display:"none"},attrs:{id:"image-upload-"+n._id,type:"file",accept:"image/*"},on:{change:e.handleImageUpload}})])]:["createdAt","updatedAt"].includes(header.key)?[t("span",[e._v(e._s(new Date(n[header.key]).toLocaleString()))])]:"0"===n._id?[t("input",{directives:[{name:"model",rawName:"v-model",value:n[header.key],expression:"item[header.key]"}],staticClass:"table-input",class:{first:"name"===header.key||"unit"===header.key,dirty:e.isKeyDirty(n._id,header.key)},attrs:{type:"text",placeholder:header.key},domProps:{value:n[header.key]},on:{focus:function(t){return e.setFocused({item:n,inputId:"".concat(header.key,"-").concat(n._id)})},input:[function(t){t.target.composing||e.$set(n,header.key,t.target.value)},function(t){return e.onFieldInput(n._id,header.key)}]}})]:[t("input",{directives:[{name:"model",rawName:"v-model",value:n[header.key],expression:"item[header.key]"}],staticClass:"table-input",class:{first:"name"===header.key||"unit"===header.key,dirty:e.isKeyDirty(n._id,header.key)},attrs:{type:"text"},domProps:{value:n[header.key]},on:{focus:function(t){return e.setFocused({item:n,inputId:"".concat(header.key,"-").concat(n._id)})},input:[function(t){t.target.composing||e.$set(n,header.key,t.target.value)},function(t){return e.onFieldInput(n._id,header.key)}]}})]],2)])})),0)]}))],2)])])])])}),[],!1,null,null,null);t.default=component.exports}}]);